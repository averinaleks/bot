Отчёт по работе с Python-ботом для торговли
=========================================

Введение
--------
В рамках задачи требовалось развернуть и протестировать торгового бота из репозитория GitHub `averinaleks/bot`. Из-за ограничений сети прямое выполнение `git clone` было недоступно, поэтому исходный код получали через внутренние API. Ниже описаны подготовка окружения, запуск в оффлайн-режиме, а также выявленные проблемы и способы их устранения.

Получение исходного кода
------------------------
Основной входной скрипт — `run_bot.py`. В нём реализован парсинг аргументов командной строки, загрузка конфигурации, запуск торговых и симуляционных циклов и выбор фабрик сервисов. При запуске с флагом `--offline` бот подменяет фабрики сервисов заглушками и работает без реальных API-ключей.

Конфигурация описана в `config.py` классом `BotConfig`: параметры биржи, риск-менеджмент, настройки моделей и другие поля. Конфигурация считывается из JSON и/или переменных окружения.

Для оффлайн-режима предусмотрены заглушки:
- `services/offline.py` — классы `OfflineBybit`, `OfflineTelegram`, `OfflineGPT`, `OfflineTradeManager` и словарь `OFFLINE_SERVICE_FACTORIES`, заменяющий реальные сервисы фиктивными значениями.
- `data_handler/offline.py` — генерация синтетических OHLCV-данных и индикаторов без зависимостей `pandas` и `numpy`; метод `refresh` пересоздаёт набор данных.
- `model_builder/offline.py` — возвращает нейтральные сигналы и не требует ML-библиотек.
- В `trade_manager/__init__.py` указано, что при активном оффлайн-режиме используются классы из `services.offline` вместо полноценного торгового менеджера.

Поскольку клон репозитория был недоступен, исходники ключевых файлов (например, `run_bot.py`, `config.py`, `utils.py`, `services/offline.py`, `data_handler/offline.py`, `model_builder/offline.py`, `services/stubs.py`, `services/service_factories.py`, `http_client.py`) запрашивались через API и сохранялись локально в каталоге проекта с сохранением структуры модулей. Файлы, которые используются только в онлайн-режиме (например, `model_builder/core.py`, `data_handler/core.py`), не копировались, так как оффлайн-режим их не требует.

Настройка виртуального окружения
--------------------------------
1. Создан каталог проекта `/home/oai/share/bot_repo` со структурами пакетов `bot`, `services`, `data_handler`, `model_builder` и пустыми `__init__.py` для корректных импортов.
2. Создано виртуальное окружение:
   ```bash
   cd /home/oai/share/bot_repo
   python3 -m venv venv
   source venv/bin/activate
   ```
3. Установлены только базовые зависимости (например, `fastapi`, `uvicorn`, `httpx`), поскольку оффлайн-режим не требует большинства пакетов из `requirements.txt`. При необходимости можно выполнить `pip install -r requirements.txt`, но это может занять много времени, а отдельные пакеты могут быть недоступны.

Запуск бота в оффлайн-режиме
----------------------------
Перед запуском нужно определить переменную окружения `CSRF_SECRET`, иначе FastAPI не стартует:
```bash
export CSRF_SECRET="$(python -c 'import secrets; print(secrets.token_hex(32))')"
```

Запуск бота:
```bash
python run_bot.py --offline
```
Скрипт активирует оффлайн-режим, подменяет фабрики сервисов `OFFLINE_SERVICE_FACTORIES`, загружает конфигурацию, инициализирует обработчик данных, построитель модели и менеджер сделок. В логах видно создание синтетических данных и отсутствие запросов к внешним API. Логи записываются в каталог `logs/`, путь можно изменить через конфигурацию.

Анализ ошибок и их устранение
-----------------------------
| Тип ошибки | Возможная причина | Решение |
| --- | --- | --- |
| ImportError / ModuleNotFoundError | Отсутствует модуль или пакет из `requirements.txt`. | Проверить наличие файла в локальном каталоге, при необходимости установить зависимость или добавить заглушку. Например, `bot/dotenv_utils.py` безопасно обрабатывает отсутствие `python-dotenv`. |
| RuntimeError о CSRF | Не задана переменная `CSRF_SECRET`. | Установить переменную окружения, как показано выше. |
| AttributeError / ValueError | Ошибка в логике или некорректная конфигурация. | Изучить traceback и исходный код на указанной строке. В оффлайн-режиме большинство потенциальных ошибок устранено заменой на заглушки. |
| Отсутствие зависимостей (NumPy, pandas) | В оффлайн-режиме не требуются. | Игнорировать предупреждения либо установить пакеты при переходе в онлайн-режим. |

Для поиска причин ошибок полезно просматривать файлы логов (`logs/`) и запускать линтеры или тесты (`pytest`), чтобы выявлять скрытые проблемы.

Повторный тест и верификация
----------------------------
После устранения ошибок перезапустите бота. При корректном оффлайн-настройке в консоли будут сообщения о генерации синтетических данных и запуске торгового/симуляционного цикла без внешних запросов. При отсутствии исключений можно считать, что бот работает корректно. Дополнительно можно запустить тесты:
```bash
pytest tests/
```

Заключение
----------
Из-за сетевых ограничений репозиторий получали через GitHub API. Несмотря на множество внешних зависимостей, оффлайн-режим позволяет запустить бота без реальных API-ключей и без установки тяжёлых пакетов. В отчёте описаны шаги по получению исходников, подготовке окружения, запуску с заглушками и разбору типовых ошибок. Эти инструкции помогут развернуть и протестировать бота в оффлайн-режиме и подготовиться к дальнейшему развитию или переходу к боевому режиму.
