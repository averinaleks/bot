Отчёт по работе с Python-ботом для торговли
=========================================

Введение
--------
В рамках задачи требовалось развернуть и протестировать торгового бота из репозитория GitHub `averinaleks/bot`. Исходный код доступен напрямую из репозитория (можно использовать обычный `git clone` или `Download ZIP`). Ниже описаны подготовка окружения, запуск в оффлайн-режиме, а также выявленные проблемы и способы их устранения.

Получение исходного кода
------------------------
Основной входной скрипт — `run_bot.py`. В нём реализован парсинг аргументов командной строки, загрузка конфигурации, запуск торговых и симуляционных циклов и выбор фабрик сервисов. При запуске с флагом `--offline` бот подменяет фабрики сервисов заглушками и работает без реальных API-ключей.

Конфигурация описана в `config.py` классом `BotConfig`: параметры биржи, риск-менеджмент, настройки моделей и другие поля. Конфигурация считывается из JSON и/или переменных окружения.

Для оффлайн-режима предусмотрены заглушки:
- `services/offline.py` — классы `OfflineBybit`, `OfflineTelegram`, `OfflineGPT`, `OfflineTradeManager` и словарь `OFFLINE_SERVICE_FACTORIES`, заменяющий реальные сервисы фиктивными значениями.
- `data_handler/offline.py` — генерация синтетических OHLCV-данных и индикаторов без зависимостей `pandas` и `numpy`; метод `refresh` пересоздаёт набор данных.
- `model_builder/offline.py` — возвращает нейтральные сигналы и не требует ML-библиотек.
- В `trade_manager/__init__.py` указано, что при активном оффлайн-режиме используются классы из `services.offline` вместо полноценного торгового менеджера.

Репозиторий уже содержит все перечисленные модули (например, `run_bot.py`, `config.py`, `services/offline.py`, `data_handler/offline.py`, `model_builder/offline.py`, `services/stubs.py`, `services/service_factories.py`, `http_client.py` и др.), поэтому дополнительных загрузок не требуется. В онлайн-режиме используются те же файлы, что и в оффлайн-режиме; при отсутствии опциональных зависимостей бот автоматически переключается на заглушки.

Настройка виртуального окружения
--------------------------------
1. Перейдите в каталог проекта, например `/workspace/bot`:
   ```bash
   cd /workspace/bot
   ```
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
3. Установите зависимости из поставки (при необходимости добавьте GPU- или тестовые профили):
   ```bash
   python -m pip install -r requirements.txt
   # при наличии GPU
   python -m pip install -r requirements-gpu.txt
   # для запуска линтеров и тестов
   python -m pip install -r requirements-dev.txt
   ```

Запуск бота в оффлайн-режиме
----------------------------
Перед запуском нужно определить переменную окружения `CSRF_SECRET`, иначе FastAPI не стартует:
```bash
export CSRF_SECRET="$(python -c 'import secrets; print(secrets.token_hex(32))')"
```

Запуск бота:
```bash
python run_bot.py --offline
```
Скрипт активирует оффлайн-режим, подменяет фабрики сервисов `OFFLINE_SERVICE_FACTORIES`, загружает конфигурацию, инициализирует обработчик данных, построитель модели и менеджер сделок. В логах видно создание синтетических данных и отсутствие запросов к внешним API. Логи записываются в каталог `logs/`, путь можно изменить через конфигурацию.

Анализ ошибок и их устранение
-----------------------------
| Тип ошибки | Возможная причина | Решение |
| --- | --- | --- |
| ImportError / ModuleNotFoundError | Отсутствует модуль или пакет из `requirements.txt`. | Установить зависимость из `requirements.txt` или добавить нужный профиль (`requirements-gpu.txt`, `requirements-dev.txt`). Например, `bot/dotenv_utils.py` безопасно обрабатывает отсутствие `python-dotenv`, поэтому эта зависимость необязательна. |
| RuntimeError о CSRF | Не задана переменная `CSRF_SECRET`. | Установить переменную окружения, как показано выше. |
| AttributeError / ValueError | Ошибка в логике или некорректная конфигурация. | Изучить traceback и исходный код на указанной строке. В оффлайн-режиме большинство потенциальных ошибок устранено заменой на заглушки. |
| Отсутствие зависимостей (NumPy, pandas) | В оффлайн-режиме не требуются. | Игнорировать предупреждения либо установить пакеты при переходе в онлайн-режим. |

Для поиска причин ошибок полезно просматривать файлы логов (`logs/`) и запускать линтеры или тесты (`pytest`), чтобы выявлять скрытые проблемы. В стандартной среде тесты требуют зависимостей из `requirements-dev.txt`.

Повторный тест и верификация
----------------------------
После устранения ошибок перезапустите бота. При корректном оффлайн-настройке в консоли будут сообщения о генерации синтетических данных и запуске торгового/симуляционного цикла без внешних запросов. При отсутствии исключений можно считать, что бот работает корректно. Дополнительно можно запустить тесты:
```bash
pytest tests/
```

Заключение
----------
Репозиторий доступен напрямую, поэтому достаточно обычного клонирования или загрузки ZIP. Несмотря на множество внешних зависимостей, оффлайн-режим позволяет запустить бота без реальных API-ключей и без установки тяжёлых пакетов. В отчёте описаны шаги по получению исходников, подготовке окружения, запуску с заглушками и разбору типовых ошибок. Эти инструкции помогут развернуть и протестировать бота в оффлайн-режиме и подготовиться к дальнейшему развитию или переходу к боевому режиму.
