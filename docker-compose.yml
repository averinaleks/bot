version: '3'
services:
  data_handler:
    build: .
    command: python data_handler.py
    networks:
      - trading_bot_default
  model_builder:
    build: .
    command: python model_builder.py
    networks:
      - trading_bot_default
  trade_manager:
    build: .
    command: python trade_manager.py
    networks:
      - trading_bot_default
  trading_bot:
    build:
      context: .
      dockerfile: Dockerfile
    command: python trading_bot.py
    depends_on:
      - data_handler
      - model_builder
      - trade_manager
    environment:
      - DATA_HANDLER_URL=http://data_handler:8000
      - MODEL_BUILDER_URL=http://model_builder:8001
      - TRADE_MANAGER_URL=http://trade_manager:8002
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - PYTHONUNBUFFERED=1
      - BYBIT_API_KEY=${BYBIT_API_KEY}
      - BYBIT_API_SECRET=${BYBIT_API_SECRET}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - CACHE_DIR=/app/cache
      - LOG_DIR=/app/logs
      - MODEL_SAVE_PATH=/app/models
      - CONFIG_PATH=/app/config.json
    volumes:
      - ./logs:/app/logs
      - ./models:/app/models
      - ./cache:/app/cache
      - ./config.json:/app/config.json
    networks:
      - trading_bot_default
    restart: unless-stopped
    shm_size: '8gb'
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
networks:
  trading_bot_default:
    driver: bridge
