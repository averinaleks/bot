# Trading Bot

Этот репозиторий содержит пример торгового бота на Python. Для запуска необходимы файлы `config.json` и `.env` с ключами API.

## Быстрый старт

1. Установите зависимости:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```
2. Создайте файл `.env` по примеру `.env.example` и укажите свои значения.
3. Отредактируйте `config.json` под свои нужды. Помимо основных настроек можно
   задать параметры адаптации порогов:
   - `loss_streak_threshold` и `win_streak_threshold` контролируют количество
     подряд убыточных или прибыльных сделок, после которого базовый порог
     вероятности будет соответственно повышен или понижен.
   - `threshold_adjustment` задаёт величину изменения порога.
   - `target_change_threshold` задаёт минимальный процент изменения цены для положительной метки при обучении модели.
   - `backtest_interval` определяет, как часто выполняется автоматический бектест стратегии.
   - `max_symbols` задаёт количество наиболее ликвидных торговых пар, которые бот выберет из доступных.
   - `max_subscriptions_per_connection` определяет, сколько символов подписывается через одно WebSocket-соединение.
    - `subscription_batch_size` задаёт размер пакета подписок, отправляемых за один запрос.
    - `subscription_batch_delay` задаёт задержку между такими пакетами.
4. Запустите бота:
   ```bash
   python trading_bot.py
   ```

Также можно использовать `docker-compose up --build` для запуска в контейнере.

## Лимиты WebSocket-подписок

Количество подписок через одно соединение ограничивается параметром `max_subscriptions_per_connection`. Если список пар превышает это значение, бот откроет дополнительные WebSocket-соединения.

Подписки отправляются пакетами. Размер пакета задаётся опцией `subscription_batch_size`, а задержку между пакетами можно настроить через `subscription_batch_delay` (в секундах). Это помогает не превышать лимиты биржи на частоту запросов.

Пример настроек в `config.json`:

```json
{
    "max_subscriptions_per_connection": 30,
    "subscription_batch_size": 20,
    "subscription_batch_delay": 0.5
}
```

Так бот будет разбивать список подписок на пакеты по 20–30 символов и делать короткую паузу между отправками. Для большинства бирж подойдут значения 20–30 символов в пакете и задержка 0.5–1 секунды.
