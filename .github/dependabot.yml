---
version: 2

registries:
  pytorch-cpu:
    type: python-index
    url: https://download.pytorch.org/whl/cpu
    replaces-base: false

updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "daily"
    insecure-external-code-execution: allow
    registries:
      - pytorch-cpu
    ignore:
      # Heavy ML packages routinely fail to resolve in Dependabot's
      # constrained execution environment.  Skip them so the scheduled
      # job stops erroring while manual updates continue to happen via
      # regular PRs.
      - dependency-name: "mlflow"
      - dependency-name: "mlflow-skinny"
      - dependency-name: "mlflow-tracing"
      - dependency-name: "pytorch-lightning"
      - dependency-name: "torch"
      - dependency-name: "torchvision"
      - dependency-name: "torchaudio"
      - dependency-name: "vllm"
      # GPU-tuned runtimes and their support stack take several minutes to
      # resolve and routinely trigger the 20 minute timeout in the
      # dependabot/dependabot-updates workflow.  Exclude them from automated
      # refreshes so the job completes successfully and we can batch these
      # upgrades manually when GPU images are rebuilt.
      - dependency-name: "cupy-cuda12x"
      - dependency-name: "tensorflow"
      - dependency-name: "keras"
      - dependency-name: "tensorboard"
      - dependency-name: "tensorboard-data-server"
      - dependency-name: "ml-dtypes"
      - dependency-name: "opt-einsum"
      - dependency-name: "optree"
      - dependency-name: "sympy"
      # Reinforcement learning stacks also exceed Dependabot's solver
      # thresholds; keep them frozen until we refresh the training images
      # out-of-band.
      - dependency-name: "stable-baselines3"
      - dependency-name: "gymnasium"
      - dependency-name: "ray"
      # ccxtpro is a commercial package that often trips Dependabot's rate
      # limits; it is safer to upgrade it manually together with the
      # matching back-end services.
      - dependency-name: "ccxtpro"
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
